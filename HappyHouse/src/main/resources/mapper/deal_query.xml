<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN"    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.happyhouse.dao.DealDao">
	<select id="dealList" parameterType="int" resultType="com.ssafy.happyhouse.dto.DealDto">
	SELECT d.NO deal_no, d.APTNAME, d.CODE gugun_code, d.dong, d.DEALAMOUNT, d.BUILDYEAR, d.DEALYEAR, d.DEALMONTH, d.DEALDAY, d.AREA, d.FLOOR, d.JIBUN, d.TYPE, d.RENTMONEY, i.LAT, i.LNG, i.IMG
		FROM HOUSEDEAL d, HOUSEINFO i
  		WHERE d.APTNAME = i.APTNAME AND d.CODE = i.CODE AND d.DONG = i.DONG
  		ORDER BY d.NO DESC
  		LIMIT #{limit} OFFSET #{offset};
	</select>
	
	<select id="dealListTotalCnt" resultType="int">
		SELECT COUNT(*) FROM HOUSEDEAL
	</select>
	
	<select id="dealListSearchDong" parameterType="com.ssafy.happyhouse.dto.DealParamDto" resultType="com.ssafy.happyhouse.dto.DealDto">
		SELECT d.NO deal_no, d.DONG, d.APTNAME, d.CODE gugun_code, d.DEALAMOUNT, d.BUILDYEAR, d.DEALYEAR, d.DEALMONTH, d.DEALDAY, d.AREA, d.FLOOR, d.JIBUN, d.TYPE, d.RENTMONEY, i.LAT, i.LNG, i.IMG
	  	  FROM HOUSEDEAL d, HOUSEINFO i
	  	  WHERE d.APTNAME = i.APTNAME AND d.CODE = i.CODE AND d.DONG = i.DONG AND d.DONG = #{searchWord}
	  	  ORDER BY d.NO DESC
	  	  LIMIT #{limit} OFFSET #{offset};
	</select>
	
	<select id="dealListSearchDongTotalCnt" parameterType="string" resultType="int">
		SELECT COUNT(*)
		  FROM HOUSEDEAL d 
		  WHERE d.DONG = #{searchDong}
	</select>
	
	<select id="dealListSearchApt" parameterType="com.ssafy.happyhouse.dto.DealParamDto" resultType="com.ssafy.happyhouse.dto.DealDto">
		SELECT d.NO, d.DONG, d.APTNAME, d.CODE, d.DEALAMOUNT, d.BUILDYEAR, d.DEALYEAR, d.DEALMONTH, d.DEALDAY, d.AREA, d.FLOOR, d.JIBUN, d.TYPE, d.RENTMONEY, i.LAT, i.LNG, i.IMG
		  FROM HOUSEDEAL d, HOUSEINFO i
		  WHERE d.APTNAME = i.APTNAME AND d.CODE = i.CODE AND d.DONG = i.DONG AND d.APTNAME like CONCAT('%', #{searchWord}, '%')
		  ORDER BY d.NO DESC
	 	  LIMIT #{limit} OFFSET #{offset}
	</select>
	
	<select id="dealListSearchAptTotalCnt" parameterType="com.ssafy.happyhouse.dto.DealParamDto" resultType="int">
		SELECT COUNT(*) FROM HOUSEDEAL d
  		  WHERE d.APTNAME like CONCAT('%', #{searchWord}, '%')
	</select>
</mapper>